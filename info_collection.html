<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>媒体嘉宾签到表</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; }
        .success-message { display: none; background-color: #dff0d8; color: #3c763d; padding: 15px; margin-top: 20px; border-radius: 4px; }
        .language-selector { text-align: right; margin-bottom: 20px; }
        h1 { color: #333; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="language-selector">
        <button onclick="changeLanguage('cn')" id="cn-btn">中文</button>
        <button onclick="changeLanguage('en')" id="en-btn">English</button>
    </div>
    
    <h1 id="formTitle">Media Guest Check-in Form</h1>
    
    <form id="contactForm">
        <div class="form-group">
            <label for="name" id="nameLabel">Name</label>
            <input type="text" id="name" name="name" required list="name-suggestions">
            <datalist id="name-suggestions"></datalist>
            </div>
        <div class="form-group"> <label for="email" id="emailLabel">Email</label> <input type="email" id="email" name="email" required> </div>
        <div class="form-group"> <label for="phone" id="phoneLabel">Phone Number</label> <input type="tel" id="phone" name="phone"> </div>
        <div class="form-group"> <label for="media" id="mediaLabel">Media Organization</label> <input type="text" id="media" name="media" required> </div>
        <div class="form-group"> <label for="country" id="countryLabel">Country/Region</label> <input type="text" id="country" name="country" required> </div>
        <div class="form-group"> <label for="interests" id="interestsLabel">Areas of Interest</label> <textarea id="interests" name="interests" rows="3"></textarea> </div>
        <button type="submit" id="submitBtn">Submit Information</button>
    </form>
    
    <div class="success-message" id="successMessage">
        <p id="thankYouMessage">Thank you for submitting your information! We will contact you soon.</p>
    </div>
    
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwNCZUg5wtiWdlrd0AqnJgJtEo9YdtVPmqxhvITsWmNDwaSO4Qc0NXE-YHIyf-8HFIr/exec"; 

        const translations = {
            cn: { formTitle: "媒体嘉宾签到表", nameLabel: "姓名", emailLabel: "电子邮箱", phoneLabel: "电话号码", mediaLabel: "所属媒体机构", countryLabel: "国家/地区", interestsLabel: "感兴趣的报道领域", submitBtn: "提交信息", thankYouMessage: "感谢您提交信息！我们将尽快与您联系。" },
            en: { formTitle: "Media Guest Check-in Form", nameLabel: "Name", emailLabel: "Email", phoneLabel: "Phone Number", mediaLabel: "Media Organization", countryLabel: "Country/Region", interestsLabel: "Areas of Interest", submitBtn: "Submit Information", thankYouMessage: "Thank you for submitting your information! We will contact you soon." }
        };
        
        function changeLanguage(lang) {
            Object.keys(translations[lang]).forEach(key => {
                const element = document.getElementById(key);
                if (element) element.textContent = translations[lang][key];
            });
        }
        
        document.getElementById("contactForm").addEventListener("submit", function(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById("submitBtn");
            submitBtn.disabled = true;
            submitBtn.textContent = "Submitting...";

            const formData = {
                name: document.getElementById("name").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                media: document.getElementById("media").value,
                country: document.getElementById("country").value,
                interests: document.getElementById("interests").value,
            };
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => {
                document.getElementById("successMessage").style.display = "block";
                document.getElementById("contactForm").reset();
                setTimeout(() => { document.getElementById("successMessage").style.display = "none"; }, 3000);
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Submission failed. Please try again later.");
            })
            .finally(() => {
                submitBtn.disabled = false;
                const currentLangIsCn = document.getElementById("formTitle").textContent === "媒体嘉宾签到表";
                changeLanguage(currentLangIsCn ? 'cn' : 'en');
            });
        });

        // ==================== 最终版：带建议列表的填充逻辑 START ====================
        const nameInput = document.getElementById('name');
        const mediaInput = document.getElementById('media');
        const countryInput = document.getElementById('country');
        const suggestionsDatalist = document.getElementById('name-suggestions');
        const rulesKey = 'prefillRules';
        
        const prefillRules = JSON.parse(localStorage.getItem(rulesKey)) || [];

        nameInput.addEventListener('input', function() {
            const currentName = this.value.toLowerCase().trim();
            
            // 每次输入都先清空旧的建议和填充
            suggestionsDatalist.innerHTML = '';
            mediaInput.value = '';
            countryInput.value = '';

            if (currentName.length === 0) {
                return; // 如果输入框为空，则不进行任何操作
            }

            // 步骤1: 查找所有部分匹配的规则，生成建议列表
            const matchingRules = prefillRules.filter(rule => 
                rule.triggerName.toLowerCase().includes(currentName)
            );

            matchingRules.forEach(rule => {
                const option = document.createElement('option');
                option.value = rule.triggerName;
                suggestionsDatalist.appendChild(option);
            });

            // 步骤2: 检查是否存在一个精确匹配的规则（通常在用户从建议列表中选择后发生）
            const exactMatchRule = prefillRules.find(rule => 
                rule.triggerName.toLowerCase() === currentName
            );

            if (exactMatchRule) {
                // 如果有精确匹配，则填充表单
                mediaInput.value = exactMatchRule.media;
                countryInput.value = exactMatchRule.country;
            }
        });
        // ==================== 最终版：带建议列表的填充逻辑 END ======================

        // 页面加载后默认设置为英文
        window.onload = function() {
            changeLanguage('en');
        };
    </script>
</body>
</html>